activationtype=passive
flags=dont_stop_at_caster_death,special

targetgroupcount=1
targetgroup[0].targettype=event_targets
targetgroup[0].event=death
targetgroup[0].eventtarget=caster
targetgroup[0].cleanuptargets=1

actioncount=4
action[0].type=set_flag
action[0].targettype=caster
action[0].soldierflag=ignored_by_traps

action[1].type=create_magic
action[1].targetgroupindex=0
action[1].pertargetconditions=soldier_has_token(!waveserpent_summon_done)
action[1].skill=Waveserpent_summon_death
action[1].eothandling=old_stop

action[2].type=create_magic
action[2].targetgroupindex=0
action[2].skill=Waveserpent_explode

action[3].type=conditional_stop_magic
action[3].targetgroupindex=0

